# إصلاح منطق حساب الرواتب

## المشكلة السابقة

كان النظام يخصم أيام الغياب من **الراتب الأساسي** (`baseSalary`)، مما يعني:
- الراتب الأساسي يتغير حسب الغياب
- هذا غير صحيح منطقياً

## الحل المطبق

### المنطق الجديد:

1. **الراتب الأساسي (`baseSalary`)**:
   - يبقى **ثابت** = `employee.salary`
   - لا يتغير إلا في حالات خاصة:
     - الموظف بدأ في منتصف الشهر → حساب نسبي
     - الموظف منتهي الخدمة → حساب نسبي
     - الموظف موقوف → حساب نسبي حسب نوع الإيقاف

2. **خصم الغياب (`absentDeduction`)**:
   - يُحسب منفصلاً: `dailySalary × totalAbsentDays`
   - **يُخصم من صافي الراتب** وليس من الراتب الأساسي

3. **صافي الراتب (`netSalary`)**:
   ```
   netSalary = baseSalary 
             + overtimePay           (الساعات الإضافية)
             + totalBonuses         (المكافآت)
             - absentDeduction      (خصم الغياب)
             - timeDelayDeduction   (خصم التأخير الزمني)
             - nonTimeDelayDeduction (خصم التأخير غير الزمني)
             - totalDeductions     (الخصومات)
             - totalAdvances        (السلف)
   ```

## مثال توضيحي

### قبل الإصلاح:
```
الراتب الأساسي: 3000
أيام غياب (بتبليغ): 2 يوم
الراتب الأساسي بعد الخصم: 3000 - (100 × 2) = 2800 ❌
```

### بعد الإصلاح:
```
الراتب الأساسي: 3000 (ثابت) ✅
خصم الغياب: 100 × 2 = 200
صافي الراتب: 3000 - 200 = 2800 ✅
```

## الحالات الخاصة

### 1. موظف بدأ في منتصف الشهر:
```
الراتب الأساسي = (الأيام من تاريخ التعيين / 30) × الراتب الكامل
```

### 2. موظف منتهي الخدمة:
```
الراتب الأساسي = (الأيام حتى تاريخ الإنهاء / 30) × الراتب الكامل
```

### 3. موظف موقوف:
- **مع راتب**: حساب نسبي للأيام قبل الإيقاف
- **بدون راتب**: الراتب الأساسي = 0 أو حساب نسبي

## التحقق من الإصلاح

بعد إعادة حساب الرواتب، تحقق من:
1. ✅ الراتب الأساسي يبقى ثابت (عدا الحالات الخاصة)
2. ✅ خصم الغياب يُحسب بشكل صحيح
3. ✅ صافي الراتب = الراتب الأساسي - جميع الاستقطاعات

## ملاحظات

- **يجب إعادة حساب الرواتب** بعد هذا التحديث
- الراتب الأساسي الآن يعكس الراتب الفعلي المستحق (نسبي في الحالات الخاصة)
- جميع الاستقطاعات تُخصم من صافي الراتب

