# المنطق النهائي الصحيح لحساب الرواتب

## المبدأ الأساسي

**الراتب الأساسي يبقى ثابت** - لا يتم استقطاع أي شيء منه  
**جميع الاستقطاعات تُخصم من صافي الراتب**

## المعادلات

### 1. الراتب الأساسي (ثابت):
```
baseSalary = employee.salary
```
- هذا هو الراتب الأساسي من بيانات الموظف
- **لا يتغير أبداً** - يبقى ثابت

### 2. الراتب اليومي:
```
dailySalary = baseSalary ÷ 30
```

### 3. الراتب المستحق للشهر:
```
monthlySalaryDue = dailySalary × أيام الحضور
```
- يعتمد فقط على أيام الحضور
- لا يوجد خصم للغياب (لأن الراتب يعتمد على الحضور فقط)

### 4. صافي الراتب:
```
netSalary = monthlySalaryDue
         + overtimePay           (الساعات الإضافية)
         + totalBonuses          (المكافآت)
         - timeDelayDeduction    (التأخير الزمني)
         - nonTimeDelayDeduction (التأخير غير الزمني)
         - totalDeductions       (الخصومات)
         - totalAdvances         (السلف)
```

## مثال توضيحي

### بيانات:
- **الراتب الأساسي**: 750,000 د.ع (ثابت)
- **أيام الحضور**: 25 يوم
- **أيام الغياب**: 5 أيام
- **ساعات إضافية**: 10 ساعات
- **تأخير زمني**: 30 دقيقة
- **مكافأة**: 50,000 د.ع
- **خصم**: 20,000 د.ع

### الحساب:

#### 1. الراتب الأساسي (ثابت):
```
baseSalary = 750,000 د.ع ✅ (لا يتغير)
```

#### 2. الراتب اليومي:
```
dailySalary = 750,000 ÷ 30 = 25,000 د.ع/يوم
```

#### 3. الراتب المستحق:
```
monthlySalaryDue = 25,000 × 25 = 625,000 د.ع
```

#### 4. الساعات الإضافية:
```
hourlySalary = 750,000 ÷ (30 × 8) = 3,125 د.ع/ساعة
overtimePay = 10 × 3,125 = 31,250 د.ع
```

#### 5. التأخير الزمني:
```
minuteSalary = 3,125 ÷ 60 = 52.08 د.ع/دقيقة
timeDelayDeduction = 30 × 52.08 = 1,562.5 د.ع
```

#### 6. صافي الراتب:
```
netSalary = 625,000          (الراتب المستحق)
         + 31,250            (الساعات الإضافية)
         + 50,000            (المكافأة)
         - 1,562.5           (التأخير الزمني)
         - 20,000            (الخصم)
         = 684,687.5 د.ع
```

## الفرق بين الحقول

### في قاعدة البيانات:
- **baseSalary**: الراتب الأساسي (ثابت = employee.salary)
- **netSalary**: صافي الراتب (بعد جميع الإضافات والاستقطاعات)

### للعرض فقط (لا يُحفظ في DB):
- **monthlySalaryDue**: الراتب المستحق (الراتب اليومي × أيام الحضور)
- **absentDeduction**: خصم الغياب (0 لأن الراتب يعتمد على الحضور)

## التحقق من الصحة

✅ **الراتب الأساسي ثابت** - لا يتغير أبداً  
✅ **الراتب المستحق** يعتمد على أيام الحضور فقط  
✅ **جميع الاستقطاعات** تُخصم من صافي الراتب  
✅ **لا يوجد خصم للغياب** - لأن الراتب يعتمد على الحضور فقط

## ملاحظات مهمة

1. **baseSalary** في قاعدة البيانات = `employee.salary` (ثابت)
2. **netSalary** في قاعدة البيانات = الراتب النهائي بعد جميع الحسابات
3. **monthlySalaryDue** للعرض فقط - يُحسب من `dailySalary × presentDays`
4. أي تغيير في الدوام يتطلب **إعادة حساب الرواتب**

