# دليل استيراد البيانات إلى الاستضافة (Supabase)

## المشكلة
عند رفع المشروع على Vercel، قاعدة البيانات فارغة لأن البيانات موجودة فقط في النظام المحلي.

## الحل: استيراد البيانات من النظام المحلي إلى Supabase

### الخطوة 1: تصدير البيانات من النظام المحلي

إذا كان لديك النظام المحلي القديم يعمل:

1. **افتح النظام المحلي** في المتصفح
2. **اذهب إلى إعدادات النسخ الاحتياطي** (Backup & Restore)
3. **اضغط على "تصدير النسخة الاحتياطية"** (Export Backup)
4. **احفظ الملف** في مكان آمن (مثلاً: `C:\Users\HR\backup.json`)

ملف النسخة الاحتياطية يجب أن يحتوي على:
```json
{
  "employees": [...],
  "attendance": [...],
  "payroll": [...],
  "deductions": [...],
  "quickCodes": [...]
}
```

### الخطوة 2: التأكد من إعدادات قاعدة البيانات

قبل الاستيراد، تأكد من أن ملف `.env.local` يحتوي على `DATABASE_URL` الصحيح:

```env
DATABASE_URL=postgresql://user:password@host:port/database
```

**مهم:** استخدم `DATABASE_URL` الخاص بـ Supabase (ليس المحلي).

### الخطوة 3: استيراد البيانات إلى Supabase

1. **افتح Terminal** في مجلد المشروع:
   ```bash
   cd "C:\Users\HR\Videos\Payroll System"
   ```

2. **شغّل script الاستيراد:**
   ```bash
   node scripts/import-local-data.js "C:\Users\HR\backup.json"
   ```

   **ملاحظة:** استبدل `C:\Users\HR\backup.json` بمسار ملف النسخة الاحتياطية الفعلي.

3. **انتظر حتى يكتمل الاستيراد:**
   - سترى رسائل تظهر تقدم الاستيراد
   - ✅ عند اكتمال كل قسم (موظفين، حضور، رواتب، إلخ)

### الخطوة 4: التحقق من الاستيراد

بعد اكتمال الاستيراد:

1. **افتح الموقع على Vercel:**
   - https://svc-payroll.vercel.app/dashboard

2. **تحقق من:**
   - ✅ صفحة الموظفين - يجب أن تظهر جميع الموظفين
   - ✅ صفحة تسجيل الدوام - يجب أن تظهر سجلات الحضور
   - ✅ صفحة الرواتب - يجب أن تظهر قسائم الرواتب

## إذا لم يكن لديك نسخة احتياطية

إذا لم يكن لديك ملف نسخة احتياطية من النظام المحلي:

### الخيار 1: إنشاء بيانات تجريبية

يمكنك إضافة البيانات يدوياً من خلال:
- صفحة "إضافة موظف جديد" في الموقع
- صفحة "تسجيل الدوام" لتسجيل الحضور
- صفحة "الرواتب" لحساب الرواتب

### الخيار 2: استخدام Prisma Studio

1. **شغّل Prisma Studio:**
   ```bash
   npm run prisma:studio
   ```

2. **افتح المتصفح على:** http://localhost:5555

3. **أضف البيانات يدوياً:**
   - اضغط على جدول `employees` وأضف موظفين
   - اضغط على جدول `attendance` وأضف سجلات حضور
   - اضغط على جدول `payroll` وأضف قسائم رواتب

## استكشاف الأخطاء

### خطأ: "الملف غير موجود"
- **الحل:** تحقق من مسار الملف واسمه

### خطأ: "موظف غير موجود"
- **الحل:** هذا تحذير طبيعي - يعني أن سجل حضور يشير لموظف غير موجود
- **الإجراء:** تأكد من استيراد الموظفين أولاً

### خطأ: "Connection refused" أو "Database connection failed"
- **الحل:** 
  1. تحقق من `DATABASE_URL` في `.env.local`
  2. تأكد من أن Supabase يعمل
  3. تحقق من أن Firewall لا يمنع الاتصال

### البيانات لا تظهر في الموقع
- **الحل:**
  1. تحقق من أن الاستيراد اكتمل بنجاح
  2. افتح Prisma Studio وتحقق من وجود البيانات
  3. أعد تحميل الصفحة (Ctrl+F5)

## ملاحظات مهمة

- ✅ **Script الاستيراد آمن:** يمكن تشغيله عدة مرات - يستخدم `upsert` لذلك لن يكرر البيانات
- ✅ **البيانات محفوظة:** جميع البيانات (موظفين، حضور، رواتب) يتم استيرادها
- ✅ **التواريخ محفوظة:** جميع التواريخ والتواريخ المهمة محفوظة كما هي

## مثال كامل

```bash
# 1. تصدير من النظام المحلي (افتح النظام المحلي وصدّر النسخة الاحتياطية)
# 2. حفظ الملف في: C:\Users\HR\backup-2026-02-13.json

# 3. استيراد إلى Supabase
cd "C:\Users\HR\Videos\Payroll System"
node scripts/import-local-data.js "C:\Users\HR\backup-2026-02-13.json"

# 4. انتظر حتى يكتمل الاستيراد
# 5. افتح الموقع وتحقق من البيانات
```

## بعد الاستيراد

بعد استيراد البيانات بنجاح:
- ✅ جميع الموظفين ستظهر في صفحة الموظفين
- ✅ جميع سجلات الحضور ستظهر في صفحة تسجيل الدوام
- ✅ جميع قسائم الرواتب ستظهر في صفحة الرواتب
- ✅ الموقع جاهز للاستخدام!

