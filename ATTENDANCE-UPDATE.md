# تحديث نظام تسجيل الدوام

## التغييرات المطبقة

تم تطوير نظام تسجيل الدوام ليعمل مثل النظام المحلي السابق مع الميزات التالية:

### 1. الحقول الجديدة في جدول Attendance

- **absentType**: حقل جديد لتحديد نوع الغياب
  - `with_notice`: غياب بتبليغ (يعتبر غياب عادي - يخصم يوم واحد)
  - `without_notice`: غياب بدون تبليغ (يضرب في 2 - يخصم يومين)

### 2. الحقول الموجودة (تم تفعيلها في الواجهة)

- **overtimeHours**: ساعات إضافية
- **timeDelayMinutes**: تأخير زمني (بالدقائق) - يخصم دقيقة بدقيقة
- **nonTimeDelayMinutes**: تأخير غير زمني (بالدقائق) - يضرب في 2 (دقيقة = دقيقتين خصم)

### 3. حالات الدوام

- **حاضر**: الحضور العادي
- **غياب (بتبليغ)**: غياب عادي - يخصم يوم واحد
- **غياب (بدون تبليغ)**: غياب بدون تبليغ - يضرب في 2 (يخصم يومين)
- **إجازة**: إجازة رسمية
- **عطلة**: عطلة رسمية

### 4. منطق الحساب

#### حساب الرواتب:
- **الغياب بتبليغ**: يخصم يوم واحد من الراتب
- **الغياب بدون تبليغ**: يخصم يومين من الراتب (يضرب في 2)
- **التأخير الزمني**: يخصم دقيقة بدقيقة من الراتب
- **التأخير غير الزمني**: يضرب في 2 (دقيقة = دقيقتين خصم)
- **الساعات الإضافية**: تضاف إلى الراتب بنفس معدل الساعة العادي

## تحديث قاعدة البيانات

يجب تشغيل migration لإضافة الحقل الجديد `absentType`:

```bash
# توليد Prisma Client
npx prisma generate

# إنشاء migration جديد
npx prisma migrate dev --name add_absent_type

# أو إذا كنت تريد رفع التغييرات مباشرة (للتطوير فقط)
npx prisma db push
```

## الملفات المحدثة

1. **prisma/schema.prisma**: إضافة حقل `absentType` إلى جدول Attendance
2. **app/api/attendance/route.js**: تحديث POST route لدعم `absentType`
3. **app/api/attendance/[id]/route.js**: تحديث PUT route لدعم جميع الحقول
4. **app/attendance/page.js**: تحديث الواجهة لعرض جميع الحقول وإضافة خيارات الغياب

## كيفية الاستخدام

### تسجيل دوام جديد:
1. اختر الموظف والتاريخ
2. اختر الحالة (حاضر، غياب بتبليغ، غياب بدون تبليغ، إجازة، عطلة)
3. يمكن تعديل الحقول بعد التسجيل مباشرة من الجدول

### تعديل دوام موجود:
1. من جدول "دوام اليوم"
2. يمكن تعديل:
   - الحالة من القائمة المنسدلة
   - ساعات إضافية
   - تأخير زمني (دقائق)
   - تأخير غير زمني (دقائق)
3. التغييرات تُحفظ تلقائياً

## ملاحظات مهمة

- جميع الحسابات تتم تلقائياً عند حساب الرواتب
- التأخير غير الزمني يضرب في 2 تلقائياً في الحساب
- الغياب بدون تبليغ يضرب في 2 تلقائياً في الحساب
- يمكن تغيير حالة الدوام في أي وقت

